---
import Layout from '../../Base.astro';
import BlogArchiveSidebar from '../../components/BlogArchiveSidebar.astro';
import Tease from '../../components/Tease.astro';

export async function getStaticPaths() {
	const response = await fetch(`${import.meta.env.PUBLIC_WP_URL}/categories?per_page=100`);
	const posts = await response.json();
	return posts.map((category) => {
		return {
			params: { category: category.slug },
			props: {
				title: category.name,
				slug: category.slug,
				id: category.id
			}
		};
	});
}

const { title, slug, id } = Astro.props;

const requestPosts = await fetch(`${import.meta.env.PUBLIC_WP_URL}/posts?per_page=100&categories=${id}`);
const posts = await requestPosts.json();
---

<Layout title='Kelp Current' darkHeader={true} bodyClass='blog-archive'>
	<article class='wrapper archive'>
		<BlogArchiveSidebar />
		{posts.map((post) => <Tease post={post} />)}
	</article>
</Layout>
