---
import Layout from '../../Base.astro';
import SimpleHero from '../../components/SimpleHero.astro';
import Testimonials from '../../components/Testimonials.astro';
import Services from "../../components/Services.astro";
import HowWeWork from "../../components/HowWeWork.astro";

import countries from 'countrycitystatejson';
import slugify from 'slugify';

export async function getStaticPaths() {
	const usa = countries.getCountryByShort('US');
	const florida = usa.states['Florida'];

	return florida.map((city, index) => {
		const slug = slugify(city.name, { lower: true, strict: true });
		const cityName = city.name.replace("''", "'");
		const total = florida.length;
		const nearbyCities = [
			florida[(index - 1 + total) % total],
			florida[(index + 1) % total],
			florida[(index + 2) % total],
		].map((nearby) => nearby.name.replace("''", "'"));
		return {
			params: { city: slug },
			props: {
				title: `${cityName}, FL Digital Agency | Kelp Creative Agency`,
				cityName,
				nearbyCities,
			}
		};
	});
}

const { title, cityName, nearbyCities } = Astro.props;
const description = `Kelp Creative Agency helps ${cityName}, FL businesses with branding, websites, and marketing. See nearby case studies, clear pricing, and fast support.`;
const caseStudies = [
	{
		title: 'Blue Stone Construction',
		href: '/work/blue-stone-construction/',
		detail: 'Brand and website refresh for a growing contractor.',
	},
	{
		title: 'Mountaineer Coffee',
		href: '/work/mountaineer-coffee/',
		detail: 'Ecommerce and identity updates built for scale.',
	},
	{
		title: 'Spring Water Spirits',
		href: '/work/spring-water-spirits/',
		detail: 'Packaging and digital presence with a premium feel.',
	},
];
const localSchema = {
	'@type': 'LocalBusiness',
	'@id': `${Astro.url.href}#localbusiness`,
	name: 'Kelp Creative Agency',
	url: Astro.url.href,
	telephone: '+1-352-325-7688',
	address: {
		'@type': 'PostalAddress',
		addressLocality: 'Brooksville',
		addressRegion: 'FL',
		postalCode: '34601',
		streetAddress: '707 Harvard St.',
		addressCountry: 'US',
	},
	areaServed: {
		'@type': 'City',
		name: cityName,
		addressRegion: 'FL',
		addressCountry: 'US',
	},
};

// 
// const data = {
// 	model: "gpt-3.5-turbo",
// 	messages: [
// 		{
// 			role: "system",
// 			content:
// 				"You are an SEO expert for a marketing agency that helps get clients to the first page of Google search results by writing helpful content."
// 		},
// 		{ role: "user", content: `write a paragraph of text for a city page for a digital agency called "Kelp" and about why a local agency to ${title} is important, try to include some unique info about said city.` }
// 	],
// 	temperature: 0.7,
// 	max_tokens: 700
// };
// 
// const chatGpt = await fetch("https://api.openai.com/v1/chat/completions", {
// 	headers: {
// 		Authorization: `Bearer ${import.meta.env.OPENAI_KEY}`,
// 		"Content-Type": "application/json"
// 	},
// 	method: "POST",
// 	body: JSON.stringify(data)
// });
// const response = await chatGpt.json();
// const text = response.choices[0].message.content;
// 
// 
// const data2 = {
// 	model: "gpt-3.5-turbo",
// 	messages: [
// 		{
// 			role: "system",
// 			content:
// 				"You are an SEO expert for a digital agency that helps get clients to the first page of Google search results by writing helpful content."
// 		},
// 		{ role: "user", content: `write a meta description for a city page about a digital agency called "Kelp" local to ${title}, keep it under 170 characters and don't put it in quotation marks.` }
// 	],
// 	temperature: 0.7,
// 	max_tokens: 700
// };
// const chatGpt2 = await fetch("https://api.openai.com/v1/chat/completions", {
// 	headers: {
// 		Authorization: `Bearer ${import.meta.env.OPENAI_KEY}`,
// 		"Content-Type": "application/json"
// 	},
// 	method: "POST",
// 	body: JSON.stringify(data2)
// });
// const response2 = await chatGpt2.json();
// const text2 = response2.choices[0].message.content;


---

<Layout
	title={title}
	description={description}
	schema={localSchema}
>
	<SimpleHero
		tagline='Digital Agency serving:'
		title={title.replace('Digital Agency | Kelp Creative Agency', '')}
		description={description}
	/>
	<div class='wrapper wrapper--narrow dark' style='margin-bottom: 150px;'>
		<h2 class='h3'>Why a local agency matters in {cityName}</h2>
		<p>
			As a Florida-based agency, we understand the market around {cityName} and what local buyers expect online. We keep
			projects lean, move fast, and build brands and websites that feel regional without sacrificing quality. That means
			clear positioning, thoughtful design, and marketing that matches how people in {cityName} actually search, browse,
			and buy.
		</p>
	</div>
	<section class="wrapper wrapper--narrow">
		<h2 class="h3">Recent work near {cityName}</h2>
		<p>
			Here are a few recent projects that reflect the kind of results we deliver for Florida businesses.
		</p>
		<ul class="city-case-studies">
			{caseStudies.map((study) => (
				<li>
					<a href={study.href}>{study.title}</a> â€” {study.detail}
				</li>
			))}
		</ul>
	</section>
	<section class="wrapper wrapper--narrow">
		<h2 class="h3">How we help {cityName} teams</h2>
		<ul class="city-services">
			<li>Brand identity, messaging, and visual systems that create trust.</li>
			<li>High-performance websites that convert and are easy to manage.</li>
			<li>Marketing strategy and content that drives qualified leads.</li>
		</ul>
	</section>
	<section class="wrapper wrapper--narrow">
		<h2 class="h3">Serving {cityName} and nearby areas</h2>
		<ul class="city-nearby">
			{nearbyCities.map((nearbyCity) => (
				<li>
					<a href={`/florida/${slugify(nearbyCity, { lower: true, strict: true })}/`}>{nearbyCity}</a>
				</li>
			))}
		</ul>
	</section>
	<section class="wrapper wrapper--narrow">
		<h2 class="h3">FAQs for {cityName} businesses</h2>
		<div class="city-faq">
			<h3 class="h5">Do you work with teams in {cityName}?</h3>
			<p>
				Yes. We partner with businesses across Florida and routinely support teams in and around {cityName}.
			</p>
			<h3 class="h5">What services are most popular in {cityName}?</h3>
			<p>
				Web design, brand identity, and marketing strategy are the most common starting points for companies in the area.
			</p>
			<h3 class="h5">How fast can a project start?</h3>
			<p>
				Most projects kick off within a few weeks depending on scope. We will confirm a timeline after a short discovery.
			</p>
		</div>
	</section>
	<Services />
	<HowWeWork />
	<Testimonials />
</Layout>
